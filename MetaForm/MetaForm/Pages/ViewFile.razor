@page "/view-file/{fileName}"
@inject IWebHostEnvironment WebHostEnvironment
@inject IJSRuntime JSRuntime
@using System.IO

@code {
    [Parameter]
    public string FileName { get; set; }

    private string FileContent { get; set; }

    protected override void OnParametersSet()
    {
        var filePath = Path.Combine(WebHostEnvironment.WebRootPath, "uploads", FileName);
        if (System.IO.File.Exists(filePath))
        {
            FileContent = System.IO.File.ReadAllText(filePath);
        }
        else
        {
            FileContent = "File not found.";
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Exécution du JavaScript contenu dans le fichier HTML
            await JSRuntime.InvokeVoidAsync("eval", @"
                document.querySelectorAll('script').forEach(oldScript => {
                    const newScript = document.createElement('script');
                    newScript.innerHTML = oldScript.innerHTML;
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });
            ");

            // Charger et exécuter le fichier JavaScript associé
            var jsFilePath = Path.Combine(WebHostEnvironment.WebRootPath, "uploads", Path.ChangeExtension(FileName, ".js"));
            if (System.IO.File.Exists(jsFilePath))
            {
                var jsContent = System.IO.File.ReadAllText(jsFilePath);
                await JSRuntime.InvokeVoidAsync("eval", jsContent);
            }

            // Appeler les fonctions de la librairie JS après le rendu
            await JSRuntime.InvokeVoidAsync("associateForm", "exampleForm", 1, 1); // Exemple d'appel à associateForm
                                                                                   // Ajouter d'autres appels si nécessaire
            await JSRuntime.InvokeVoidAsync("associateTextField", "Nom", "Nom");
            await JSRuntime.InvokeVoidAsync("associateSelectField", "Region", 2, "Id", "Nom", "Region");
        }
    }
}

<h3>File Content: @FileName</h3>
<div>@((MarkupString)FileContent)</div>